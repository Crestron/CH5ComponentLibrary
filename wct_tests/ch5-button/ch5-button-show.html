<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <script src="/webcomponentsjs/webcomponents-lite.js"></script>
    <script>void (0)</script>
    <script src="/bower_components/web-component-tester/browser.js"></script>
    <link rel="stylesheet" type="text/css" href="/wct_tests/themes/crestron-components-assets/base.css">

    <script src="/build_bundles/umd/cr-com-lib.js"></script>
    <script src="/wct_tests/ch5-button/js/helpers.js"></script>
</head>

<body>

    <test-fixture id="ch5-button-show-fixture">
        <template>
            <ch5-button></ch5-button>
        </template>
    </test-fixture>

    <script>
        suite('ch5-button', () => {

            let ch5Button;

            setup(async () => {
                const emulatorJson = await fetch('./emulator/show.json').then((response) => response.json());
                const emulator = CrComLib.Ch5Emulator.getInstance();
                emulator.loadScenario(emulatorJson);
                ch5Button = fixture('ch5-button-show-fixture');
            });

            const availableshow = [
                {
                    key: true,
                    value: true
                },
                {
                    key: false,
                    value: false
                },
                {
                    key: "true",
                    value: true
                },
                {
                    key: "false",
                    value: false
                },
                {
                    key: "TRUE",
                    value: true
                },
                {
                    key: "FALSE",
                    value: false
                }
            ];

            // TODO - failing for FALSE

            const valid_noShowTypes = [
                { key: 'display', css: 'ch5-hide-dis' },
                { key: 'remove', css: '' },
                { key: 'visibility', css: 'ch5-hide-vis' }];
            const invalid_noShowTypes = ['', null, 'Display', 'None', 'Visibility'];

            availableshow.forEach((showName, i) => {
                test(`Check attribute show: "${showName.key}"`, () => {
                    ch5Button.setAttribute('show', showName.key);
                    expect(ch5Button.show).to.be.equal(showName.value);
                });
                test(`Check ch5-button > div css class name for show: "${showName.key}"`, () => {
                    ch5Button.setAttribute('show', showName.key);
                    expect(ch5Button.classList.contains(valid_noShowTypes.find(val => val.key === 'display').css)).to.be.equal(!showName.value);
                });

                valid_noShowTypes.forEach((validNoShowType, j) => {
                    test(`Check attribute show: "${showName.key}" and noShowType: "${validNoShowType.key}"`, () => {
                        ch5Button.setAttribute('show', showName.key);
                        ch5Button.setAttribute('noShowType', validNoShowType.key);
                        expect(ch5Button.show).to.be.equal(showName.value);
                    });
                    test(`Check ch5-button > div css class name for show: "${showName.key}" and noShowType: "${validNoShowType.key}"`, () => {
                        ch5Button.setAttribute('show', showName.key);
                        ch5Button.setAttribute('noShowType', validNoShowType.key);
                        if (validNoShowType.key === 'remove') {
                            expect(!!(ch5Button)).to.be.equal(true);
                        } else {
                            expect(ch5Button.classList.contains(valid_noShowTypes.find(val => val.key === validNoShowType.key).css)).to.be.equal(!showName.value);
                        }
                    });
                });
            });

            [true, false].forEach((showName, i) => {
                test(`receiveStateShow: "${showName}"`, (done) => {
                    ch5Button.setAttribute('receiveStateShow', 'show_button');
                    CrComLib.publishEvent('b', 'toggle_btn_visibility', showName);
                    flush(() => {
                        setTimeout(() => {
                            expect(ch5Button.getAttribute('show')).to.be.equal(String(showName).toLowerCase());
                            expect(ch5Button.show).to.be.equal(showName);
                            done();
                        }, 100);
                    });
                });
            });

            // Creating separate for loops to manage flush and setTimeout individiually for each text fixture
            [true, false].forEach((showName, i) => {
                test(`Check ch5-button > div css class name for receiveStateShow: "${showName}"`, (done) => {
                    ch5Button.setAttribute('receiveStateShow', 'show_button');
                    CrComLib.publishEvent('b', 'toggle_btn_visibility', showName);
                    flush(() => {
                        setTimeout(() => {
                            expect(ch5Button.classList.contains(valid_noShowTypes.find(val => val.key === 'display').css)).to.be.equal(!showName);
                            done();
                        }, 100);
                    });
                });
            });

            // TODO - issue is with toggle - need to change in emulator

            // // Creating separate for loops to manage flush and setTimeout individiually for each text fixture
            // [true, false].forEach((showName, i) => {
            //     valid_noShowTypes.forEach((validNoShowType, j) => {
            //         test(`Check attribute show: "${showName}" and noShowType: "${validNoShowType.key}"`, (done) => {
            //             ch5Button.setAttribute('receiveStateShow', 'show_button');
            //             CrComLib.publishEvent('b', 'toggle_btn_visibility', showName);
            //             ch5Button.setAttribute('noShowType', validNoShowType.key);
            //             flush(() => {
            //                 setTimeout(() => {
            //                     expect(ch5Button.show).to.be.equal(showName);
            //                     done();
            //                 }, 100);
            //             });
            //         });
            //     });
            // });

            // // Creating separate for loops to manage flush and setTimeout individiually for each text fixture
            // [true, false].forEach((showName, i) => {
            //     valid_noShowTypes.forEach((validNoShowType, j) => {
            //         test(`Check attribute show: "${showName}" and noShowType: "${validNoShowType.key}"`, () => {
            //             ch5Button.setAttribute('receiveStateShow', 'show_button');
            //             CrComLib.publishEvent('b', 'toggle_btn_visibility', showName);
            //             ch5Button.setAttribute('noShowType', validNoShowType.key);
            //             flush(() => {
            //                 setTimeout(() => {
            //                     expect(ch5Button.show).to.be.equal(showName);
            //                     done();
            //                 }, 100);
            //             });
            //         });
            //     });
            // });

            // // Creating separate for loops to manage flush and setTimeout individiually for each text fixture
            // [true, false].forEach((showName, i) => {
            //     valid_noShowTypes.forEach((validNoShowType, j) => {
            //         test(`Check ch5-button > div css class name for show: "${showName}" and noShowType: "${validNoShowType.key}"`, (done) => {
            //             ch5Button.setAttribute('show', showName);
            //             ch5Button.setAttribute('receiveStateShow', 'show_button');
            // CrComLib.publishEvent('b', 'toggle_btn_visibility', showName);

            //             ch5Button.setAttribute('noShowType', validNoShowType.key);

            //             flush(() => {
            //                 setTimeout(() => {
            //                     if (validNoShowType.key === 'remove') {
            //                         expect(!!(ch5Button)).to.be.equal(true);
            //                     } else {
            //                         expect(ch5Button.classList.contains(valid_noShowTypes.find(val => val.key === validNoShowType.key).css)).to.be.equal(!showName);
            //                     }
            //                     done();
            //                 }, 100);
            //             });
            //         });
            //     });
            // });

            // TODO - test the pulse for false
            test(`receiveStateShowPulse: true"`, (done) => {
                ch5Button.setAttribute('receiveStateShowPulse', 'sig_pulse_show');
                ch5Button.setAttribute('receiveStateHidePulse', 'sig_pulse_hide');
                CrComLib.publishEvent('b', 'sig_pulse_show', true);
                flush(() => {
                    setTimeout(() => {
                        expect(ch5Button.getAttribute('show')).to.be.equal('true');
                        expect(ch5Button.show).to.be.equal(true);
                        done();
                    }, 100);
                });
            });

            test(`receiveStateHidePulse: true"`, (done) => {
                ch5Button.setAttribute('receiveStateShowPulse', 'sig_pulse_show');
                ch5Button.setAttribute('receiveStateHidePulse', 'sig_pulse_hide');
                CrComLib.publishEvent('b', 'sig_pulse_hide', true);
                flush(() => {
                    setTimeout(() => {
                        expect(ch5Button.getAttribute('show')).to.be.equal('false');
                        expect(ch5Button.show).to.be.equal(false);
                        done();
                    }, 100);
                });
            });

        });
    </script>
</body>

</html>